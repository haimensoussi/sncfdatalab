name: ğŸš€ Deploy to Databricks TEST (from main)

on:
  push:
    branches:
      - main    # ğŸ”¹ DÃ©ploiement dÃ©clenchÃ© uniquement quand main est mise Ã  jour

jobs:
  deploy-to-test:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: âš™ï¸ Set up Databricks CLI
        uses: databricks/setup-cli@v1

      - name: ğŸ” Authenticate to Databricks TEST
        env:
          DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST_TEST }}
          DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN_TEST }}
        run: |
          echo "Connexion au workspace TEST : $DATABRICKS_HOST"

      - name: ğŸ“¦ Deploy notebooks to TEST
        run: |
          databricks workspace import_dir notebooks /Shared/sncfdatalab --overwrite
          echo "âœ… DÃ©ploiement rÃ©ussi sur TEST."
